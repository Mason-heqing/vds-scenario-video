webpackJsonp([9],{"10/O":function(t,e,a){var i=a("DhHD");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("2d1f1c24",i,!0)},DhHD:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,"\n.grant-box[data-v-51e98276]{text-align:left;cursor:pointer\n}\n.grant-box>div[data-v-51e98276]{height:6px;background:#00a65a;border-radius:3px\n}\n.grant-box>div.grant-color-s[data-v-51e98276]{width:100%;background:#00a65a\n}\n.grant-box>div.grant-color-f[data-v-51e98276]{width:0;background:#dd4b39\n}\n.grant-box>div.grant-color-half[data-v-51e98276]{width:50%;background:#e6a23c\n}\n.grant-box>span[data-v-51e98276]{padding:0px 6px;height:18px;display:inline-block;border-radius:10px;text-align:center;color:#fff;line-height:18px;font-size:12px\n}\n.grant-box>span.grant-num-s[data-v-51e98276]{background:#00a65a\n}\n.grant-box>span.grant-num-f[data-v-51e98276]{background:#dd4b39\n}\n.grant-box>span.grant-num-half[data-v-51e98276]{background:#e6a23c\n}\n.form-group[data-v-51e98276] .el-date-editor .el-range-input{width:44%\n}\n.center-style[data-v-51e98276]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center\n}\n.my-wth[data-v-51e98276]{width:5%\n}\n.el-row[data-v-51e98276]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center\n}\n.pay-orcode[data-v-51e98276] .el-dialog__body{padding:0px 20px\n}\n.flex-style[data-v-51e98276]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end\n}\n.red[data-v-51e98276]{color:red;font-size:12px\n}\n[data-v-51e98276] .el-checkbox-group{margin-right:10px\n}\n.checkbox-div[data-v-51e98276]{padding:0 10px\n}\n",""])},MZpG:function(t,e,a){"use strict";function i(t){a("10/O")}Object.defineProperty(e,"__esModule",{value:!0});var s,l=a("bOdI"),o=a.n(l),n=a("TtmE"),c=a("pOg+"),r=a("18Ef"),d=a("D7x1"),p=a("lbHh"),u=a.n(p),g=(s={name:"home",data:function(){return{msg:"订单列表",currentPage:1,popVisible:!1,payDialogVisible:!1,payImg:"",orderName:"",orderAmount:0,payNum:null,socketUrl:"",userId:null,popTitle:"这个是标题",popContent:"这个是内容",total:0,tableData:[],multipleSelection:[],value:"",value1:"",dataForm:{orgId:u.a.get("orgId"),currentPage:1,pageSize:10,category:null,paid:null},productTypeList:[{name:"全部",id:""},{name:"激活包",id:3},{name:"专线包",id:2}],payType:[{value:"",label:"全部"},{value:0,label:"未支付"},{value:1,label:"已支付"}],tableLabel:[{label:"orderId",param:"orderId",align:"left",sortable:!0,isshow:!1,width:"100"},{label:"orgId",param:"orgId",align:"left",sortable:!0,isshow:!1,width:"100"},{label:"创建时间",param:"createTime",align:"center",sortable:!0,isshow:!0,width:"100"},{label:"产品类型",param:"categoryName",align:"center",sortable:!0,isshow:!0,width:"100"},{label:"规格",param:"specificationDesc",align:"left",sortable:!0,isshow:!0,width:"80"},{label:"数量",param:"quantity",align:"center",sortable:!0,isshow:!0,width:"100"},{label:"总价(元)",param:"totalPrice",align:"center",sortable:!0,isshow:!0,width:"90"},{label:"支付状态",param:"paidDesc",align:"center",sortable:!0,isshow:!0,width:"90"},{slot:"operate",isshow:!0}],listData:[],tableOption:[],tableSelect:[],isShowSelect:!0,loading:!1,imgurl:"",dialogVisible:!1,activeNamePaytype:"second",timesLength:"",play_package:"",payTimes:"",paySpecialNum:"1",tiemsNum:1,isMaster:!1,durationGoodsList:[],specialGoodsMap:[],timespackAgeId:"",timesPackageprice:0,timesTotal:0,usefulLife:"",specialSubset:[],specialSubsetItem:[],deviceNum:0,specialPackageprice:0,specialPackageTotal:0,activePackAgeNum:1,activeTimesPackageprice:0,timesActiveTotal:0,activePackAgeId:"",isBtn:!1}},filters:{},created:function(){this.isMaster="false"!=u.a.get("isMaster");for(var t=0;t<this.tableLabel.length;t++)this.tableLabel[t].label&&this.tableOption.push(this.tableLabel[t].label),this.tableLabel[t].isshow&&this.tableSelect.push(this.tableLabel[t].label);this.imgurl=this.tools.global.API_URL},computed:{},watch:{},components:{MsgBox:n.a,ExportBox:c.a,AuthBox:r.a,TableCmp:d.a}},o()(s,"filters",{clTime:function(t){return t.split(" ")[0]}}),o()(s,"mounted",function(){this.getTableData(),this.getgoods(),this.getWebsocketUrl()}),o()(s,"destroyed",function(){this.payImg&&""!=this.payImg&&this.socketApi.websocketclose()}),o()(s,"methods",{websocketToLogin:function(){var t={type:"WS_SUBSCRIBE",userId:this.userId};this.socketApi.sendSock(t,this.getConfigResult)},getConfigResult:function(t){console.log("接收回调函数返回数据的方法",t),"WS_SUBSCRIBE"==t.type||"WS_PAY_COMP"==t.type&&(this.payDialogVisible=!1,this.utils.tip("success","支付成功!"),this.socketApi.websocketclose(),this.getTableData())},getWebsocketUrl:function(){var t=this;this.utils.http({url:"/wx/native/getNativeSocketUrl",method:"post"},function(e){200==e.code&&(t.socketUrl=e.data,u.a.set("payWebsocketUrl",e.data.webSocketUtl),t.userId=e.data.userId),console.log("获取socket地址",e)})},goEdit:function(t){var e=this;console.log(t),this.utils.http({url:"/wx/native/unifiedOrder?orderId="+t,method:"post"},function(t){200==t.code&&(t.data.tradeState?(e.utils.tip("success","订单购买成功!"),e.getTableData()):(e.payImg=t.data.codeUrlStr,e.orderName=t.data.goodsDesc,e.orderAmount=t.data.totalPrice,e.payNum=t.data.quantity,e.payDialogVisible=!0,e.socketApi.initWebSocket(),e.websocketToLogin()))})},add:function(){this.dialogVisible=!0},onSubmit:function(){var t=this,e={goodsId:"",orderId:"",isWebmaster:this.isMaster,orgId:u.a.get("orgId"),quantity:0};if("first"==this.activeNamePaytype){if(0==this.tiemsNum)return void this.$message.error("购买数量不能为0,请重新输入购买数量!");e.goodsId=this.timesLength,e.quantity=this.tiemsNum}else if("second"==this.activeNamePaytype){if(0==this.paySpecialNum)return void this.$message.error("购买数量不能为0,请重新输入购买数量!");this.isMaster&&(e.limitDeviceNum=parseInt(this.deviceNum)),e.goodsId=this.payTimes,e.quantity=this.paySpecialNum}else{if(0==this.activePackAgeNum)return void this.$message.error("购买数量不能为0,请重新输入购买数量!");e.goodsId=this.activePackAgeId,e.quantity=this.activePackAgeNum}this.isBtn=!0,this.utils.http({url:"/order/create",method:"post",data:e},function(e){t.isBtn=!1,200==e.code&&(t.dialogVisible=!1,t.isMaster?t.utils.tip("success","订单购买成功!"):(t.payImg=e.data.codeUrlStr,t.orderName=e.data.goodsDesc,t.orderAmount=e.data.totalPrice,t.payNum=e.data.quantity,t.payDialogVisible=!0,t.socketApi.initWebSocket(),t.websocketToLogin()),t.getTableData())})},pay:function(){this.dialogVisible=!0},handleClick:function(t){this.activeNamePaytype=t.name},radioChangeG:function(t){var e=this;this.timespackAgeId=t,this.durationGoodsList.map(function(a){a.id==t&&(e.timesPackageprice=a.price,e.usefulLife=a.updateTime)}),""==this.tiemsNum?this.timesTotal=0:this.timesTotal=parseInt(this.timesPackageprice)*this.tiemsNum},changeNumTimes:function(t){this.timesTotal=parseInt(this.timesPackageprice)*t},changeActiveNumTimes:function(t){this.timesActiveTotal=parseInt(this.activeTimesPackageprice)*t},playChangedeviceNum:function(t){""==t&&(this.deviceNum=1)},radioChangeP:function(t){var e=this.specialGoodsMap.indexOf(t);this.specialSubsetItem=this.specialSubset[e],this.payTimes=this.specialSubsetItem[0].id,this.deviceNum=this.specialSubsetItem[0].limitDeviceNum,this.specialPackageprice=this.specialSubsetItem[0].price,this.specialPackageTotal=parseInt(this.specialPackageprice)*parseInt(this.paySpecialNum)},radioChangePayTimes:function(t){var e=this;this.specialSubsetItem.map(function(a){a.id==t&&(e.specialPackageprice=a.price,e.deviceNum=a.limitDeviceNum)}),this.specialPackageTotal=parseInt(this.specialPackageprice)*parseInt(this.paySpecialNum)},payChangeNum:function(t){t>this.deviceNum&&(this.paySpecialNum=this.deviceNum),""==t&&(this.paySpecialNum=1),this.specialPackageTotal=parseInt(this.specialPackageprice)*parseInt(this.paySpecialNum)},querySearch:function(){this.dataForm.currentPage=1,this.getTableData()},objfilter:function(t){var e={};for(var a in t)""!==t[a]&&null!==t[a]&&(e[a]=t[a]);return e},getTableData:function(){var t=this;this.loading=!0;var e=this.objfilter(this.dataForm);this.utils.http({url:"/order/search",method:"post",data:e},function(e){200==e.code&&(t.total=e.data.total,t.listData=e.data.records,t.currentPage=e.data.current),t.loading=!1})},getgoods:function(){var t=this;this.utils.http({url:"/goods/tab",method:"post"},function(e){if(200==e.code){if(t.specialGoodsMap=[],t.specialSubset=[],e.data.durationGoodsList&&(t.durationGoodsList=e.data.durationGoodsList,t.timesLength=e.data.durationGoodsList[0].id,t.timesPackageprice=e.data.durationGoodsList[0].price,t.timesTotal=parseInt(e.data.durationGoodsList[0].price)*parseInt(t.tiemsNum),t.usefulLife=e.data.durationGoodsList[0].updateTime),e.data.specialGoodsMap){for(var a in e.data.specialGoodsMap)t.specialGoodsMap.push(a),t.specialSubset.push(e.data.specialGoodsMap[a]);t.play_package=t.specialGoodsMap[0],t.specialSubsetItem=t.specialSubset[0],t.payTimes=t.specialSubset[0][0].id,t.deviceNum=t.specialSubset[0][0].limitDeviceNum,t.specialPackageprice=t.specialSubset[0][0].price,t.specialPackageTotal=parseInt(t.deviceNum)*parseInt(t.specialPackageprice)}e.data.activationGoods&&(t.activeTimesPackageprice=parseInt(e.data.activationGoods.price),t.timesActiveTotal=parseInt(e.data.activationGoods.price)*parseInt(t.activePackAgeNum),t.activePackAgeId=e.data.activationGoods.id)}})},resetBtn:function(){this.dataForm={currentPage:1,pageSize:10,category:null,paid:null,orgId:u.a.get("orgId")},this.getTableData()},checkboxChange:function(t){console.log(this.tableSelect);for(var e=0;e<this.tableLabel.length;e++)this.tableSelect.indexOf(this.tableLabel[e].label)>-1?this.tableLabel[e].isshow=!0:this.tableLabel[e].isshow=!1},open:function(){var t=this;this.timer=setTimeout(function(){t.popVisible=!1,clearTimeout(t.timer)},3e3)},clearSetTimeOut:function(){clearTimeout(this.timer)},handleNodeClick:function(t){console.log(t)},handleSelectionChange:function(t){this.multipleSelection=t},handleSizeChange:function(t){this.dataForm.pageSize=t,this.getTableData()},handleCurrentChange:function(t){this.dataForm.currentPage=t,this.getTableData()}}),s),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-wrapper"},[t._m(0),t._v(" "),a("section",{staticClass:"content container-fluid"},[a("div",{staticClass:"box box-primary"},[a("div",{staticClass:"box-body"},[a("div",{staticClass:"form-horizontal"},[a("div",{staticClass:"col-sm-1 pl-0"},[a("div",{staticClass:"form-group"},[a("div",{staticClass:"col-md-12"},[a("button",{staticClass:"btn btn-default",attrs:{id:"btn_device_search",type:"button"},on:{click:t.add}},[t._v("\n                  创建订单\n                ")])])])]),t._v(" "),a("div",{staticClass:"col-sm-11 text-right p-0 flex-style"},[a("div",{staticClass:"col-lg-2"},[a("div",{staticClass:"form-group"},[a("div",{staticClass:"col-md-12"},[a("el-select",{attrs:{clearable:"",placeholder:"选择产品类型"},model:{value:t.dataForm.category,callback:function(e){t.$set(t.dataForm,"category",e)},expression:"dataForm.category"}},t._l(t.productTypeList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)])]),t._v(" "),a("div",{staticClass:"col-lg-2 pl-0"},[a("div",{staticClass:"form-group"},[a("div",{staticClass:"col-md-12"},[a("el-select",{attrs:{clearable:"",placeholder:"选择支付状态"},model:{value:t.dataForm.paid,callback:function(e){t.$set(t.dataForm,"paid",e)},expression:"dataForm.paid"}},t._l(t.payType,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)])]),t._v(" "),a("div",[a("div",{staticClass:"btn-group"},[a("button",{staticClass:"btn btn-primary",attrs:{id:"btn_device_search",type:"button"},on:{click:t.querySearch}},[a("span",{staticClass:"glyphicon glyphicon-search",attrs:{"aria-hidden":"true"}}),t._v("查询\n                ")]),t._v(" "),a("button",{staticClass:"btn btn-default mr-10",attrs:{id:"btn_device_reset",type:"button"},on:{click:t.resetBtn}},[a("span",{staticClass:"fa fa-reply",attrs:{"aria-hidden":"true"}}),t._v("重置\n                ")]),t._v(" "),a("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1,placement:"bottom-start"}},[a("span",{staticClass:"el-dropdown-link"},[a("el-button",{attrs:{type:"primary",size:"small"}},[a("i",{staticClass:"el-icon-menu"}),t._v(" "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})])],1),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-checkbox-group",{on:{change:t.checkboxChange},model:{value:t.tableSelect,callback:function(e){t.tableSelect=e},expression:"tableSelect"}},t._l(t.tableOption,function(t){return a("div",{key:t,staticClass:"checkbox-div"},[a("el-checkbox",{key:t,attrs:{label:t}})],1)}))],1)],1)],1)])])]),t._v(" "),a("table-cmp",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"tableChild",attrs:{"table-data":t.listData,"table-label":t.tableLabel,"is-show-select":t.isShowSelect}},[t.isMaster?t._e():a("el-table-column",{attrs:{slot:"operate",label:"操作",align:"center",width:"150"},slot:"operate",scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-row",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.row.paid,expression:"0 === scope.row.paid"}],attrs:{title:"支付",type:"primary",icon:"el-icon-shopping-cart-full",round:"",size:"mini"},on:{click:function(a){t.goEdit(e.row.orderId)}}})],1)]}}])})],1),t._v(" "),a("div",{staticClass:"block mt-10"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,15,20,25],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)])]),t._v(" "),a("el-dialog",{attrs:{title:"创建订单",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeNamePaytype,callback:function(e){t.activeNamePaytype=e},expression:"activeNamePaytype"}},[a("el-tab-pane",{attrs:{label:"专线包",name:"second"}},[a("el-row",{attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("同时播放")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("el-radio-group",{on:{change:t.radioChangeP},model:{value:t.play_package,callback:function(e){t.play_package=e},expression:"play_package"}},t._l(t.specialGoodsMap,function(t,e){return a("el-radio-button",{key:e,attrs:{label:t}})}))],1)],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("购买时长")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("el-radio-group",{on:{change:t.radioChangePayTimes},model:{value:t.payTimes,callback:function(e){t.payTimes=e},expression:"payTimes"}},t._l(t.specialSubsetItem,function(e,i){return a("el-radio-button",{key:i,attrs:{label:e.id}},[t._v("\n                "+t._s(e.durationDesc))])}))],1)],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("购买数量")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入购买数量",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{change:t.payChangeNum},model:{value:t.paySpecialNum,callback:function(e){t.paySpecialNum=e},expression:"paySpecialNum"}}),t._v(" 个\n          ")],1)],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("可用设备数")]),t._v(" "),t.isMaster?a("el-col",{attrs:{span:19}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入限制数量",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{change:t.playChangedeviceNum},model:{value:t.deviceNum,callback:function(e){t.deviceNum=e},expression:"deviceNum"}}),t._v(" 个\n          ")],1):a("el-col",{attrs:{span:19}},[a("span",[t._v(t._s(t.deviceNum)+"个")])])],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("总价")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("span",[t._v(t._s(t.specialPackageTotal)+"元")])])],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"车牌相机视频上云激活包",name:"third"}},[a("el-row",{attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("购买数量")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入购买数量",onkeyup:"value=value.replace(/[^\\d]/g,'')"},on:{change:t.changeActiveNumTimes},model:{value:t.activePackAgeNum,callback:function(e){t.activePackAgeNum=t._n(e)},expression:"activePackAgeNum"}}),t._v(" 个\n          ")],1)],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"text-right pr-20",attrs:{span:5}},[t._v("总价")]),t._v(" "),a("el-col",{attrs:{span:19}},[a("span",[t._v(t._s(t.timesActiveTotal)+"元")])])],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"red",attrs:{span:23,offset:1}},[t._v("备注：一个激活包可供一台车牌识别相机视频上云。")])],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),t.isBtn?a("el-button",{attrs:{type:"primary",loading:!0}},[t._v("提交中")]):a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{staticClass:"pay-orcode",attrs:{title:"请使用微信支付",visible:t.payDialogVisible,width:"15%"},on:{"update:visible":function(e){t.payDialogVisible=e}}},[a("div",{staticClass:"row"},[a("el-image",{staticStyle:{width:"100%",height:"220px"},attrs:{src:t.payImg}}),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"pl-30",attrs:{span:12}},[t._v("订单号 :")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",[t._v(t._s(t.orderName))])])],1),t._v(" "),a("el-row",{staticClass:"mt-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"pl-30",attrs:{span:12}},[t._v("购买数量 :")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",[t._v(t._s(t.payNum))])])],1),t._v(" "),a("el-row",{staticClass:"mt-10 mb-10",attrs:{align:"middle"}},[a("el-col",{staticClass:"pl-30",attrs:{span:12}},[t._v("支付金额 :")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",[t._v(t._s(t.orderAmount)+" 元")])])],1)],1)])],1)},h=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"content-header"},[a("h1",{staticClass:"nice"},[t._v("\n      订单列表\n      ")]),t._v(" "),a("ol",{staticClass:"breadcrumb"},[a("li",[a("a",{attrs:{href:"/"}},[a("i",{staticClass:"glyphicon glyphicon-home"}),t._v(" 首页\n        ")])]),t._v(" "),a("li",[a("i",{staticClass:"glyphicon glyphicon-user"}),t._v(" 订单列表\n      ")])])])}],b={render:m,staticRenderFns:h},v=b,f=a("VU/8"),y=i,k=f(g,v,!1,y,"data-v-51e98276",null);e.default=k.exports}});